# Penetration Test Scope and Preparation

**Document**: MP22 — Pentest Engagement Brief
**Protocol**: Dualis Finance
**Date**: 2026-02-23
**Classification**: Confidential — Auditor/Pentest Team Only

---

## 1. Target Environment

| Target | URL / Endpoint | Protocol | Notes |
|--------|---------------|----------|-------|
| Web Application | `https://app.dualis.finance` | HTTPS | Next.js 14.2 frontend |
| REST API | `https://api.dualis.finance` | HTTPS | Fastify 5.7 backend |
| WebSocket | `wss://api.dualis.finance/ws` | WSS | Real-time price feeds, notifications |
| Health Endpoint | `https://api.dualis.finance/health` | HTTPS | Unauthenticated |

**Staging Environment** (for active testing):

| Target | URL / Endpoint | Notes |
|--------|---------------|-------|
| Web Application | `https://staging.app.dualis.finance` | Staging frontend |
| REST API | `https://staging.api.dualis.finance` | Staging API |
| WebSocket | `wss://staging.api.dualis.finance/ws` | Staging WebSocket |

All active exploitation testing must be performed against the staging environment only.

---

## 2. API Endpoint Inventory

### 2.1 Authentication (`/auth/*`)

| Method | Endpoint | Auth Required | Rate Limited |
|--------|----------|:------------:|:------------:|
| GET | `/auth/csrf-token` | No | No |
| POST | `/auth/register/retail` | No | 5/hour |
| POST | `/auth/register/institutional` | No | 5/hour |
| POST | `/auth/login` | No | 10/15min |
| POST | `/auth/wallet/nonce` | No | 20/15min |
| POST | `/auth/wallet/verify` | No | No |
| POST | `/auth/refresh` | No | No |
| POST | `/auth/logout` | Yes | No |
| GET | `/auth/me` | Yes | No |
| POST | `/auth/verify-email` | No | 10/hour |
| POST | `/auth/forgot-password` | No | 3/hour |
| POST | `/auth/reset-password` | No | 5/hour |
| POST | `/auth/link-wallet` | Yes | No |
| GET | `/auth/sessions` | Yes | No |
| DELETE | `/auth/sessions/:sessionId` | Yes | No |
| POST | `/auth/revoke-all-sessions` | Yes | No |

### 2.2 Lending (`/pools/*`, `/borrow/*`)

| Method | Endpoint | Auth Required |
|--------|----------|:------------:|
| GET | `/pools` | No |
| GET | `/pools/:poolId` | No |
| POST | `/pools/:poolId/deposit` | Yes |
| POST | `/pools/:poolId/withdraw` | Yes |
| GET | `/borrow/positions` | Yes |
| POST | `/borrow/create` | Yes |
| POST | `/borrow/:positionId/repay` | Yes |
| POST | `/borrow/:positionId/add-collateral` | Yes |
| POST | `/borrow/:positionId/remove-collateral` | Yes |

### 2.3 Staking (`/staking/*`)

| Method | Endpoint | Auth Required |
|--------|----------|:------------:|
| GET | `/staking/positions` | Yes |
| POST | `/staking/stake` | Yes |
| POST | `/staking/:positionId/unstake` | Yes |
| POST | `/staking/:positionId/claim-rewards` | Yes |

### 2.4 Credit (`/credit/*`)

| Method | Endpoint | Auth Required |
|--------|----------|:------------:|
| GET | `/credit/score` | Yes |
| GET | `/credit/breakdown` | Yes |
| GET | `/credit/history` | Yes |

### 2.5 Oracle (`/oracle/*`)

| Method | Endpoint | Auth Required |
|--------|----------|:------------:|
| GET | `/oracle/prices` | No |
| GET | `/oracle/prices/:asset` | No |
| POST | `/oracle/submit` | Yes (Operator) |

### 2.6 Compliance (`/compliance/*`)

| Method | Endpoint | Auth Required |
|--------|----------|:------------:|
| GET | `/compliance/kyc/status` | Yes |
| POST | `/compliance/kyc/initiate` | Yes |
| POST | `/compliance/kyc/webhook` | Webhook Signature |
| GET | `/compliance/aml/status` | Yes |
| GET | `/compliance/gdpr/data-export` | Yes |
| POST | `/compliance/gdpr/data-deletion` | Yes |
| GET | `/compliance/audit` | Yes (Compliance) |

### 2.7 Admin (`/admin/*`)

| Method | Endpoint | Auth Required | Role |
|--------|----------|:------------:|------|
| GET | `/admin/dashboard` | Yes | admin, compliance_officer, viewer |
| GET | `/admin/users` | Yes | admin |
| GET | `/admin/users/:userId` | Yes | admin |
| PATCH | `/admin/users/:userId` | Yes | admin |
| GET | `/admin/pools` | Yes | admin, viewer |
| PATCH | `/admin/pools/:poolId` | Yes | admin |
| GET | `/admin/oracle` | Yes | admin |
| POST | `/admin/oracle/update` | Yes | admin |
| GET | `/admin/compliance` | Yes | admin, compliance_officer |
| GET | `/admin/compliance/kyc` | Yes | admin, compliance_officer |
| GET | `/admin/compliance/gdpr` | Yes | admin, compliance_officer |
| GET | `/admin/audit` | Yes | admin |
| GET | `/admin/reports` | Yes | admin, viewer |
| GET | `/admin/settings` | Yes | admin |
| PATCH | `/admin/settings` | Yes | admin |

### 2.8 Notifications (`/notifications/*`)

| Method | Endpoint | Auth Required |
|--------|----------|:------------:|
| GET | `/notifications` | Yes |
| PATCH | `/notifications/:id/read` | Yes |
| GET | `/notifications/preferences` | Yes |
| PUT | `/notifications/preferences` | Yes |

### 2.9 Other

| Method | Endpoint | Auth Required |
|--------|----------|:------------:|
| GET | `/health` | No |
| POST | `/webhooks/:provider` | Webhook Signature |
| GET | `/analytics/protocol` | No |
| GET | `/analytics/user` | Yes |
| POST | `/flash-loan/execute` | Yes |
| GET | `/governance/proposals` | No |
| POST | `/governance/proposals` | Yes |
| POST | `/governance/proposals/:id/vote` | Yes |

---

## 3. Test User Accounts

The following test accounts will be provisioned on the staging environment:

| Role | Email | Description |
|------|-------|-------------|
| Retail User | `pentest-retail@dualis.finance` | Standard retail account, KYC verified, has active positions |
| Institutional User | `pentest-inst@dualis.finance` | Institutional account, KYB verified, higher limits |
| Admin | `pentest-admin@dualis.finance` | Full admin access to back-office panel |
| Compliance Officer | `pentest-compliance@dualis.finance` | Compliance role, KYC/AML review access |
| Viewer | `pentest-viewer@dualis.finance` | Read-only admin panel access |
| Unverified User | `pentest-unverified@dualis.finance` | Registered but email not verified, no KYC |

Wallet-based test accounts will also be provided with funded Canton wallets on devnet.

---

## 4. Out of Scope

The following are explicitly excluded from the penetration test:

| Exclusion | Reason |
|-----------|--------|
| Canton network infrastructure (sequencer, mediator, domain nodes) | Managed by Digital Asset; separate security model |
| Sumsub KYC/KYB platform | Third-party SaaS; covered by their own SOC 2 |
| Chainalysis AML service | Third-party SaaS; out of our control |
| CoinGecko / Binance APIs | Third-party data sources |
| PartyLayer SDK infrastructure | Third-party Canton middleware |
| Distributed Denial of Service (DDoS) testing | Requires separate authorization and coordination with CDN provider |
| Social engineering / phishing | Out of scope for technical pentest |
| Physical security | No physical infrastructure owned |
| DNS hijacking or BGP attacks | Network-layer attacks out of scope |

---

## 5. Priority Focus Areas

The following areas should receive the highest testing priority:

### 5.1 Authentication Bypass

- JWT token forgery or manipulation
- Refresh token reuse after rotation
- Session fixation or session hijacking
- Wallet signature verification bypass
- CSRF token bypass on state-changing endpoints
- Brute force protection bypass (timing, IP rotation)

### 5.2 Insecure Direct Object Reference (IDOR)

- Access other users' borrow positions via ID manipulation
- View other users' credit scores or KYC status
- Modify other users' notification preferences
- Access other users' sessions via `DELETE /auth/sessions/:sessionId`
- View other institutional users' compliance data

### 5.3 Rate Limit Bypass

- IP rotation to bypass per-IP rate limits
- Header spoofing (`X-Forwarded-For`, `X-Real-IP`)
- Concurrent request flooding before rate limit counter updates
- WebSocket message flooding

### 5.4 Oracle Price Manipulation

- Submit manipulated prices via oracle endpoints (if accessible)
- Exploit stale price data for favorable liquidation/borrowing
- Price feed timing attacks

### 5.5 Admin Privilege Escalation

- Horizontal escalation: viewer -> compliance_officer -> admin
- Vertical escalation: retail user -> admin
- Role manipulation via JWT claim tampering
- Admin endpoint access without proper role

### 5.6 Webhook Spoofing

- Forge Sumsub KYC webhook signatures
- Replay old webhook payloads
- Manipulate webhook payload data (approve KYC without actual verification)
- SSRF via webhook URL configuration

### 5.7 Server-Side Request Forgery (SSRF)

- Webhook URL pointing to internal network (127.0.0.1, 10.x.x.x, 169.254.x.x)
- Oracle source URL manipulation
- Any user-controlled URL parameter

### 5.8 WebSocket Security

- Authentication bypass on WebSocket upgrade
- Message injection or manipulation
- Cross-site WebSocket hijacking
- Resource exhaustion via connection flooding

---

## 6. Testing Rules of Engagement

1. **Staging only**: All active exploitation must target the staging environment. Production may be passively scanned only.
2. **No automated scanning** against production. Automated tools (Burp Scanner, Nuclei, etc.) are permitted on staging only.
3. **No DDoS or load testing** without prior written approval and coordination.
4. **Data handling**: Any PII or sensitive data encountered during testing must be reported and securely deleted after the engagement.
5. **Communication**: Findings of Critical severity must be reported immediately to `security@dualis.finance` (do not wait for the final report).
6. **Evidence**: All findings must include reproduction steps, request/response pairs, and impact assessment.
7. **Testing hours**: 24/7 against staging. Production passive scanning during business hours only (09:00-18:00 CET).

---

## 7. Deliverables

| Deliverable | Format | Deadline |
|-------------|--------|----------|
| Interim critical findings report | PDF | Within 24h of discovery |
| Full penetration test report | PDF | 5 business days after engagement end |
| Executive summary | PDF (1-2 pages) | With full report |
| Raw findings (machine-readable) | JSON/CSV | With full report |
| Retest results (after remediation) | PDF | 5 business days after retest |

---

## 8. Contact Information

| Role | Contact | Channel |
|------|---------|---------|
| Security Lead | security@dualis.finance | Email |
| Engineering Lead | engineering@dualis.finance | Email |
| Emergency Escalation | security@dualis.finance | Email (immediate) |

---

*This document is confidential and intended for the pentest engagement team only. Do not distribute outside the authorized testing team.*
